# BR0001 - User Subscribes to a Plan

## Context

We need to allow existing users to subscribe to one of the available plans. This is part of the paid user onboarding process.

## Objective

Implement an API endpoint that assigns an existing user to a selected subscription plan.

## Scope

- New endpoint in `SubscriptionService` or equivalent API layer.
- Database operation to store the subscription details linked to the user.
- Integration with existing Plan and User models/tables.

## Business Rules

1. The request must include `userId` and `selectedPlanId`.
2. The system must verify that the `userId` exists and is active.
3. The system must verify that the `selectedPlanId` exists and is active.
4. A user can only have one active subscription at a time.
5. If the user already has an active subscription, the request must be rejected.
6. Return success response with subscription details.

## Acceptance Criteria

- API endpoint: `POST /subscriptions` (or similar) assigns a plan to a user.
- Validation errors return HTTP 400 with details.
- If the user already has a subscription, return HTTP 409 (Conflict).
- Successful subscription returns HTTP 201 with:
  - `userId`
  - `planId`
  - `planName`
  - `startDate`
- Unit tests cover:
  - Successful subscription.
  - Invalid user ID scenario.
  - Invalid plan ID scenario.
  - Duplicate subscription scenario.

## Out of Scope

- Payment processing.
- Plan changes (upgrade/downgrade).
- Email notifications.

## Example Input/Output

**Input**

```json
{
  "userId": "user_67890",
  "selectedPlanId": "plan_12345"
}
```
